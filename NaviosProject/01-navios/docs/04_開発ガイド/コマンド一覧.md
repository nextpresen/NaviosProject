# Navios コマンド一覧

最終更新: 2026-02-16

Navios開発で使用する主要なコマンドを、用途別に整理しました。

## 基本コマンド

### プロジェクトのセットアップ

```bash
# 依存パッケージのインストール
npm install

# または（package-lock.jsonを厳密に守る）
npm ci
```

### 開発サーバー

```bash
# 開発サーバーを起動（http://localhost:3000）
npm run dev

# 停止: Ctrl + C
```

## ビルド・テスト

### コードチェック

```bash
# ESLintによるコードチェック
npm run lint

# 自動修正可能な問題を修正
npm run lint -- --fix
```

### ビルド

```bash
# 本番用ビルド
npm run build

# ビルド後、本番モードで起動
npm start
```

### テスト

```bash
# テスト実行
npm run test

# テストをウォッチモードで実行（変更を検知）
npm run test -- --watch
```

## データベース操作

### Prisma コマンド

```bash
# Prisma Client生成（schema.prismaから型を生成）
npm run prisma:generate

# マイグレーション適用（テーブル作成・更新）
npm run prisma:migrate

# シードデータ投入（サンプルデータを作成）
npm run prisma:seed

# データベース完全リセット（全データ削除 → マイグレーション → シード）
npm run prisma:reset
```

### Prisma Studio

```bash
# Prisma Studio起動（データベースGUIツール）
npx prisma studio

# ブラウザで http://localhost:5555 を開く
```

### マイグレーション管理

```bash
# 新しいマイグレーション作成
npx prisma migrate dev --name <マイグレーション名>

# 例: カラム追加
npx prisma migrate dev --name add_view_count

# マイグレーション履歴確認
npx prisma migrate status

# 本番環境へのマイグレーション適用
npx prisma migrate deploy
```

### スクレイピング・CSV投入

```bash
# KCICイベントをCSV化（例: 3ページ取得）
npm run scrape:events:csv -- \
  --url https://www.kcic.jp/event_list \
  --kcic-max-pages 3 \
  --default-lat 31.5966 \
  --default-lng 130.5571 \
  --out ./events_for_supabase.csv

# SupabaseへCSV投入
SUPABASE_DATABASE_URL="postgresql://..." \
npm run supabase:import:events:csv -- --file ./events_for_supabase.csv

# Supabase向けPrisma Client生成（必要時）
npx prisma generate --schema prisma/schema.supabase.prisma

# Supabaseスキーマ同期（必要時）
DATABASE_URL="$SUPABASE_DATABASE_URL" \
npx prisma db push --schema prisma/schema.supabase.prisma
```

## クリーンアップ

### ビルド成果物の削除

```bash
# .nextディレクトリを削除
rm -rf .next

# Windows PowerShellの場合
Remove-Item -Recurse -Force .next
```

### 完全クリーン

```bash
# node_modules と .next を削除して再インストール
rm -rf node_modules .next
npm install

# Windows PowerShellの場合
Remove-Item -Recurse -Force node_modules,.next
npm install
```

### データベースファイルの削除

```bash
# SQLiteファイルを削除（開発環境のみ）
rm /tmp/navios-dev.db

# Windows PowerShellの場合
Remove-Item /tmp/navios-dev.db
```

## Git操作（参考）

### 基本操作

```bash
# 現在の変更状況を確認
git status

# 変更をステージング
git add .

# コミット
git commit -m "コミットメッセージ"

# プッシュ
git push origin main
```

### ブランチ操作

```bash
# ブランチ一覧
git branch

# 新しいブランチを作成して切り替え
git checkout -b feature/新機能名

# ブランチを切り替え
git checkout main

# ブランチを削除
git branch -d feature/完了した機能名
```

## その他の便利コマンド

### ポート確認

```bash
# ポート3000を使用しているプロセスを確認
lsof -i :3000

# Windows PowerShellの場合
netstat -ano | findstr :3000

# プロセスを終了
kill -9 <PID>
```

### 容量確認

```bash
# ディレクトリ容量を確認
du -h --max-depth=2

# 特定ディレクトリのサイズ
du -sh node_modules .next
```

### ログ確認

```bash
# Next.jsのログをファイルに保存
npm run dev > logs/dev.log 2>&1
```

## package.jsonのスクリプト

`package.json` に定義されているスクリプトの一覧です。

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "test": "jest",
    "prisma:generate": "prisma generate",
    "prisma:migrate": "prisma migrate dev",
    "prisma:seed": "node prisma/seed.mjs",
    "prisma:reset": "prisma migrate reset"
  }
}
```

## 開発フロー例

### 新機能開発の典型的な流れ

```bash
# 1. ブランチ作成
git checkout -b feature/新機能

# 2. 開発サーバー起動
npm run dev

# 3. コード編集（VS Codeなどで）

# 4. コードチェック
npm run lint

# 5. ビルド確認
npm run build

# 6. コミット
git add .
git commit -m "新機能: ○○を追加"

# 7. プッシュ
git push origin feature/新機能
```

## トラブルシューティングコマンド

```bash
# キャッシュクリア
rm -rf .next node_modules
npm install

# Prisma再生成
npm run prisma:generate
npm run prisma:migrate

# 全部リセットして再構築
rm -rf .next node_modules /tmp/navios-dev.db
npm install
npm run prisma:generate
npm run prisma:migrate
npm run prisma:seed
npm run dev
```

## 参考リンク

- Next.js CLI: https://nextjs.org/docs/api-reference/cli
- Prisma CLI: https://www.prisma.io/docs/reference/api-reference/command-reference
- npm CLI: https://docs.npmjs.com/cli/
