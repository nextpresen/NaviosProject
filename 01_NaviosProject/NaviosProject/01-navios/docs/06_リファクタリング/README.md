# 06_リファクタリング

最終更新: 2026-02-16

## このフォルダについて

Naviosのコード品質向上やメンテナンス性改善のための計画と実施記録が格納されています。

## ファイル一覧

### リファクタリング定義書.md

リファクタリング（コード改善）の計画書です。

**内容:**
- 背景（なぜリファクタリングが必要か）
- 目的と非目的
- リファクタリング対象領域
- 優先順位と実施順
- 受け入れ基準
- 運用ルール
- 技術負債バックログ

**主な対象領域:**
1. 容量・運用（.next、node_modulesの管理）
2. フロントエンド構造（app/page.tsxの責務分離）
3. API・ドメイン（イベントAPI の整理）
4. データ層（Prisma schema の管理）

### リファクタリング実施チェックリスト.md

リファクタリング作業を進める際の確認項目リストです。

**チェック項目:**
1. 事前確認（スコープ明文化、影響範囲特定）
2. 容量・運用（クリーン、計測）
3. 実装（重複削減、API変更点明記）
4. 検証（ビルド、主要フロー確認）
5. ドキュメント（設計書更新）
6. 完了条件（差分最小化、ロールバック手順）

## リファクタリングとは？

**リファクタリング**とは、プログラムの動作（機能）は変えずに、コードの構造をきれいに整理する作業です。

### なぜ必要？

- コードが読みやすくなる
- バグを見つけやすくなる
- 新機能を追加しやすくなる
- メンテナンスコストが下がる

### 新機能開発との違い

| 項目 | 新機能開発 | リファクタリング |
|---|---|---|
| 動作 | 変わる | 変わらない |
| 目的 | 新しい価値を追加 | コードの質を上げる |
| ユーザー影響 | ある | ない（理想） |

## 優先順位

### P0: すぐ実施（1日）
- 容量運用ルール確定
- クリーンコマンド追加

### P1: 短期（1週間）
- app/page.tsx分割
- APIレスポンス型の統一

### P2: 中期（2〜3週間）
- map provider切替基盤の本実装
- popularity算出の標準化

## 実施の流れ

1. **計画**: リファクタリング定義書でスコープを確認
2. **事前確認**: チェックリストの「事前確認」項目を実施
3. **実装**: チェックリストに従って作業
4. **検証**: ビルド・動作確認
5. **ドキュメント更新**: 設計書に変更を記録
6. **完了**: チェックリストの「完了条件」を満たす

## 容量削減のヒント

プロジェクト容量の内訳:
- `node_modules`: 約844MB（依存ライブラリ）
- `.next`: 約443MB（ビルド成果物）
- ソースコード: 数百KB〜数MB

**削減方法:**
```bash
# ビルド成果物削除（容量削減 & クリーンビルド）
rm -rf .next

# 完全クリーン（問題解決時）
rm -rf node_modules .next
npm install
```

## 関連ドキュメント

- [02_設計書/Phase1設計書.md] - 現在の設計
- [04_開発ガイド/コマンド一覧.md] - クリーンアップコマンド
- [05_改修履歴/] - 機能追加の記録
